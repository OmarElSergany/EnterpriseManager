

DROP TABLE SEO_UPDATES;



CREATE TABLE SEO_UPDATE_STATUS
(
    SEO_DATA_ID BIGINT NOT NULL,
    PROCESS_STATUS INTEGER DEFAULT 1,
    
    
    CONSTRAINT PK_SEO_UPDATE_STATUS_ID
        PRIMARY KEY (SEO_DATA_ID),
        
    CONSTRAINT FK_SEO_UPDATE_STATUS_ID
        FOREIGN KEY (SEO_DATA_ID) REFERENCES SEO_DATA (ID) ON UPDATE CASCADE ON DELETE CASCADE
);

GRANT ALL ON TABLE SEO_UPDATE_STATUS TO PUBLIC;

SET TERM ^ ;

CREATE OR ALTER TRIGGER TR_SEO_DATA_INSERT_STATUS FOR SEO_DATA
ACTIVE AFTER INSERT POSITION 10000
AS 
BEGIN 
    INSERT INTO SEO_UPDATE_STATUS (SEO_DATA_ID, PROCESS_STATUS)
    VALUES (NEW.ID, 1);
END^

SET TERM ; ^ 

INSERT INTO SEO_UPDATE_STATUS (SEO_DATA_ID)
SELECT a.ID
FROM SEO_DATA a
WHERE a.ID NOT IN (SELECT SEO_DATA_ID FROM SEO_UPDATE_STATUS);

CREATE INDEX IDX_SEO_DATA_PAGE_VIEWS_DATE ON SEO_DATA_PAGE_VIEWS (VISITED);



CREATE TABLE SEO_REPORT_HOURLY
(
    HOURLY_DATE Date NOT NULL,
    HOURLY_HOUR INTEGER NOT NULL,
    HOURLY_QUARTER INTEGER NOT NULL,
    HOURLY_TOTALVISITS BIGINT DEFAULT 0,
    HOURLY_HUMANVISITS BIGINT DEFAULT 0,
    HOURLY_MOBILEVISITS Bigint DEFAULT 0,
    HOURLY_BOTVISITS Bigint DEFAULT 0,
    HOURLY_BOUNCED Bigint DEFAULT 0,
    HOURLY_TOTALPAGES Bigint DEFAULT 0,
    HOURLY_TOTAL_SALES NUMERIC(18, 4) DEFAULT 0.0,
    HOURLY_CONVERSIONS Bigint DEFAULT 0,
    HOURLY_MOBILECONVERSIONS Bigint DEFAULT 0,
    HOURLY_REFERUNKNOWN Bigint DEFAULT 0,
    HOURLY_REFERDIRECT Bigint DEFAULT 0,
    HOURLY_REFERAL Bigint DEFAULT 0,
    HOURLY_REFERORGANIC Bigint DEFAULT 0,
    HOURLY_REFERBING Bigint DEFAULT 0,
    HOURLY_REFERGOOGLE Bigint DEFAULT 0,
    HOURLY_REFERYAHOO Bigint DEFAULT 0,
    HOURLY_REFERFACEBOOK Bigint DEFAULT 0,
    HOURLY_REFERTWITTER Bigint DEFAULT 0,
    
    CONSTRAINT PK_SEO_REPOR_HOURLY_IDX
        PRIMARY KEY (HOURLY_DATE, HOURLY_HOUR, HOURLY_QUARTER)
);

GRANT ALL ON TABLE SEO_REPORT_HOURLY TO PUBLIC;

CREATE DESC INDEX IDX_SEO_HOURLY_DATE ON SEO_REPORT_HOURLY (HOURLY_DATE);

CREATE DESC INDEX IDX_SEO_HOURLY_HOUR ON SEO_REPORT_HOURLY (HOURLY_HOUR);

CREATE DESC INDEX IDX_SEO_HOURLY_QUARTER ON SEO_REPORT_HOURLY (HOURLY_QUARTER);



CREATE TABLE SEO_REPORT_DAILY
(
    DAILY_DATE Date NOT NULL,
    DAILY_TOTALVISITS BIGINT DEFAULT 0,
    DAILY_HUMANVISITS BIGINT DEFAULT 0,
    DAILY_MOBILEVISITS Bigint DEFAULT 0,
    DAILY_BOTVISITS Bigint DEFAULT 0,
    DAILY_BOUNCED Bigint DEFAULT 0,
    DAILY_TOTALPAGES Bigint DEFAULT 0,
    DAILY_TOTAL_SALES NUMERIC(18, 4) DEFAULT 0.0,
    DAILY_CONVERSIONS Bigint DEFAULT 0,
    DAILY_MOBILECONVERSIONS Bigint DEFAULT 0,
    DAILY_REFERUNKNOWN Bigint DEFAULT 0,
    DAILY_REFERDIRECT Bigint DEFAULT 0,
    DAILY_REFERAL Bigint DEFAULT 0,
    DAILY_REFERORGANIC Bigint DEFAULT 0,
    DAILY_REFERBING Bigint DEFAULT 0,
    DAILY_REFERGOOGLE Bigint DEFAULT 0,
    DAILY_REFERYAHOO Bigint DEFAULT 0,
    DAILY_REFERFACEBOOK Bigint DEFAULT 0,
    DAILY_REFERTWITTER Bigint DEFAULT 0,
    
    CONSTRAINT PK_SEO_REPOR_DAILY_IDX
        PRIMARY KEY (DAILY_DATE) 
);

GRANT ALL ON TABLE SEO_REPORT_DAILY TO PUBLIC;

CREATE DESC INDEX IDX_SEO_DAILY_DATE ON SEO_REPORT_DAILY (DAILY_DATE);


CREATE TABLE SEO_REPORT_WEEKLY
(
    WEEKLY_YEAR INTEGER NOT NULL,
    WEEKLY_WEEK INTEGER NOT NULL,
    WEEKLY_TOTALVISITS BIGINT DEFAULT 0,
    WEEKLY_HUMANVISITS BIGINT DEFAULT 0,
    WEEKLY_MOBILEVISITS Bigint DEFAULT 0,
    WEEKLY_BOTVISITS Bigint DEFAULT 0,
    WEEKLY_BOUNCED Bigint DEFAULT 0,
    WEEKLY_TOTALPAGES Bigint DEFAULT 0,
    WEEKLY_TOTAL_SALES NUMERIC(18, 4) DEFAULT 0.0,
    WEEKLY_CONVERSIONS Bigint DEFAULT 0,
    WEEKLY_MOBILECONVERSIONS Bigint DEFAULT 0,
    WEEKLY_REFERUNKNOWN Bigint DEFAULT 0,
    WEEKLY_REFERDIRECT Bigint DEFAULT 0,
    WEEKLY_REFERAL Bigint DEFAULT 0,
    WEEKLY_REFERORGANIC Bigint DEFAULT 0,
    WEEKLY_REFERBING Bigint DEFAULT 0,
    WEEKLY_REFERGOOGLE Bigint DEFAULT 0,
    WEEKLY_REFERYAHOO Bigint DEFAULT 0,
    WEEKLY_REFERFACEBOOK Bigint DEFAULT 0,
    WEEKLY_REFERTWITTER Bigint DEFAULT 0,
    
    CONSTRAINT PK_SEO_REPOR_WEEKLY_IDX
        PRIMARY KEY (WEEKLY_YEAR, WEEKLY_WEEK) 
);

GRANT ALL ON TABLE SEO_REPORT_WEEKLY TO PUBLIC;

CREATE DESC INDEX IDX_SEO_WEEKLY_YEAR ON SEO_REPORT_WEEKLY (WEEKLY_YEAR);

CREATE DESC INDEX IDX_SEO_WEEKLY_WEEK ON SEO_REPORT_WEEKLY (WEEKLY_WEEK);


CREATE TABLE SEO_REPORT_MONTHLY
(
    MONTHLY_YEAR INTEGER NOT NULL,
    MONTHLY_MONTH INTEGER NOT NULL,
    MONTHLY_TOTALVISITS BIGINT DEFAULT 0,
    MONTHLY_HUMANVISITS BIGINT DEFAULT 0,
    MONTHLY_MOBILEVISITS Bigint DEFAULT 0,
    MONTHLY_BOTVISITS Bigint DEFAULT 0,
    MONTHLY_BOUNCED Bigint DEFAULT 0,
    MONTHLY_TOTALPAGES Bigint DEFAULT 0,
    MONTHLY_TOTAL_SALES NUMERIC(18, 4) DEFAULT 0.0,
    MONTHLY_CONVERSIONS Bigint DEFAULT 0,
    MONTHLY_MOBILECONVERSIONS Bigint DEFAULT 0,
    MONTHLY_REFERUNKNOWN Bigint DEFAULT 0,
    MONTHLY_REFERDIRECT Bigint DEFAULT 0,
    MONTHLY_REFERAL Bigint DEFAULT 0,
    MONTHLY_REFERORGANIC Bigint DEFAULT 0,
    MONTHLY_REFERBING Bigint DEFAULT 0,
    MONTHLY_REFERGOOGLE Bigint DEFAULT 0,
    MONTHLY_REFERYAHOO Bigint DEFAULT 0,
    MONTHLY_REFERFACEBOOK Bigint DEFAULT 0,
    MONTHLY_REFERTWITTER Bigint DEFAULT 0,    
    
    CONSTRAINT PK_SEO_REPOR_MONTHLY_IDX
        PRIMARY KEY (MONTHLY_YEAR, MONTHLY_MONTH) 
);

GRANT ALL ON TABLE SEO_REPORT_MONTHLY TO PUBLIC;

CREATE DESC INDEX IDX_SEO_MONTHLY_DATE ON SEO_REPORT_MONTHLY (MONTHLY_YEAR);

CREATE DESC INDEX IDX_SEO_MONTHLY_HOUR ON SEO_REPORT_MONTHLY (MONTHLY_MONTH);

CREATE TABLE SEO_REPORT_PAGE_DATA
(
    PAGE_DATA_HASH BIGINT NOT NULL,
    PAGE_DATA_URL VARCHAR(1000) NOT NULL,
    PAGE_DATA_YEAR INTEGER NOT NULL,
    PAGE_DATA_MONTH INTEGER NOT NULl,
    PAGE_DATA_HUMAN_COUNT BIGINT DEFAULT 0,
    PAGE_DATA_BOT_COUNT BIGINT DEFAULT 0,
    
    CONSTRAINT PK_SEO_REPORT_PAGE_DATA_ID PRIMARY KEY (PAGE_DATA_HASH, PAGE_DATA_YEAR, PAGE_DATA_MONTH)
);

GRANT ALL ON TABLE SEO_REPORT_PAGE_DATA TO PUBLIC;

CREATE INDEX IDX_SEO_PAGE_DATA_HASH ON SEO_REPORT_PAGE_DATA (PAGE_DATA_HASH);

CREATE DESC INDEX IDX_SEO_PAGE_DATA_YEAR ON SEO_REPORT_PAGE_DATA (PAGE_DATA_YEAR);

CREATE DESC INDEX IDX_SEO_PAGE_DATA_MONTH ON SEO_REPORT_PAGE_DATA (PAGE_DATA_MONTH);



CREATE TABLE SEO_REPORT_SALES
(
    SALES_CITY BIGINT NOT NULL,
    SALES_YEAR INTEGER NOT NULL,
    SALES_MONTH INTEGER NOT NULl,
    SALES_COUNT BIGINT DEFAULT 0,
    SALES_CURRENCY VARCHAR(3),
    SALES_AMOUNT NUMERIC(18, 4),
    
    CONSTRAINT PK_SEO_REPORT_SALES_ID PRIMARY KEY (SALES_CITY, SALES_YEAR, SALES_MONTH, SALES_CURRENCY)
);

GRANT ALL ON TABLE SEO_REPORT_SALES TO PUBLIC;

CREATE INDEX IDX_SEO_SALES_CITY ON SEO_REPORT_SALES (SALES_CITY);

CREATE DESC INDEX IDX_SEO_SALES_YEAR ON SEO_REPORT_SALES (SALES_YEAR);

CREATE DESC INDEX IDX_SEO_SALES_MONTH ON SEO_REPORT_SALES (SALES_MONTH);


CREATE TABLE SEO_REPORT_LOCATION
(
    LOCATION_CITY BIGINT NOT NULL,
    LOCATION_YEAR INTEGER NOT NULL,
    LOCATION_MONTH INTEGER NOT NULl,
    LOCATION_COUNT BIGINT DEFAULT 0,
    
    CONSTRAINT PK_SEO_REPORT_LOCATION_ID PRIMARY KEY (LOCATION_CITY, LOCATION_YEAR, LOCATION_MONTH)
);

GRANT ALL ON TABLE SEO_REPORT_LOCATION TO PUBLIC;

CREATE INDEX IDX_SEO_LOCATION_CITY ON SEO_REPORT_LOCATION (LOCATION_CITY);

CREATE DESC INDEX IDX_SEO_LOCATION_YEAR ON SEO_REPORT_LOCATION (LOCATION_YEAR);

CREATE DESC INDEX IDX_SEO_LOCATION_MONTH ON SEO_REPORT_LOCATION (LOCATION_MONTH);



