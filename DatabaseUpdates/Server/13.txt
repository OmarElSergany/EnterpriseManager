SET TERM ^ ;
ALTER PROCEDURE SPSEO_INITIAL_REFERRER_INS (
    IPURL Varchar(1000) )
RETURNS (
    OPNEWID Bigint )
AS
BEGIN
  IF (IPURL IS NULL) THEN
    IPURL = 'Unknown';
    
  IF (EXISTS(SELECT ID FROM SEO_INITIAL_REFERRER WHERE URL = :ipURL)) THEN
  BEGIN
    SELECT FIRST 1 ID
    FROM SEO_INITIAL_REFERRER
    WHERE URL = :ipURL
    INTO :opNEWID;  
  END ELSE
  BEGIN
    opNEWID = GEN_ID(GEN_SEO_DATA_ID, 1);

    INSERT INTO SEO_INITIAL_REFERRER (
      ID,
      URL
    ) VALUES (
      :opNEWID,
      :ipURL
    );
  END

  SUSPEND;
END^
SET TERM ; ^

SET TERM ^ ;
ALTER PROCEDURE SPSEO_USER_AGENT_INS (
    IPUSER_AGENT Varchar(1000) )
RETURNS (
    OPNEWID Bigint )
AS
BEGIN
  IF (ipUSER_AGENT IS NULL) THEN
    ipUSER_AGENT = 'Unknown';
    
  IF (EXISTS(SELECT ID FROM SEO_USER_AGENT WHERE USER_AGENT = :ipUSER_AGENT)) THEN
  BEGIN
    SELECT FIRST 1 ID
    FROM SEO_USER_AGENT
    WHERE USER_AGENT = :ipUSER_AGENT
    INTO :opNEWID;  
  END ELSE
  BEGIN
    opNEWID = GEN_ID(GEN_SEO_DATA_ID, 1);

    INSERT INTO SEO_USER_AGENT (
      ID,
      USER_AGENT
    ) VALUES (
      :opNEWID,
      :ipUSER_AGENT
    );
  END

  SUSPEND;
END^
SET TERM ; ^
